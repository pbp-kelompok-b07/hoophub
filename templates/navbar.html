<nav class="relative max-w-7xl mx-auto px-6 lg:px-8 overflow-x-hidden">
    <div style="display: flex; justify-content: space-between; align-items: center; flex-shrink: 0;">
        <div style="color: #005F73; font-style: 40px; font-style: normal; font-weight: 700; line-height: normal; font-size:1.5em">
            <a href="/">hoophub</a>
        </div>

        <div class="flex items-center space-x-4">
            <div class="hidden md:flex items-center space-x-4">
                {% if user.is_authenticated %}
                <div style="color: #005F73; font-style: normal; font-weight: 500; font-size: 0.9em; display:flex; gap: 10px">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M12 0C5.4948 0 0 5.4948 0 12C0 18.5052 5.4948 24 12 24C18.5052 24 24 18.5052 24 12C24 5.4948 18.5052 0 12 0ZM12 6C14.0724 6 15.6 7.5264 15.6 9.6C15.6 11.6736 14.0724 13.2 12 13.2C9.9288 13.2 8.4 11.6736 8.4 9.6C8.4 7.5264 9.9288 6 12 6ZM5.8728 17.7264C6.9492 16.1424 8.7444 15.0864 10.8 15.0864H13.2C15.2568 15.0864 17.0508 16.1424 18.1272 17.7264C16.5936 19.368 14.418 20.4 12 20.4C9.582 20.4 7.4064 19.368 5.8728 17.7264Z" fill="#005F73"/>
                    </svg>
                    <span>Welcome back, {{ user.username }}</span>
                </div>
                <button id="logoutButton" style="color: #FFF; font-weight: 500; border-radius: 99px; text-align: center;" class="bg-[#EE9B00] font-medium px-3 py-1 hover:bg-red-400 text-sm" onclick="logout()">Logout</button>
                {% else %}
                <div style="color: #005F73; font-style: normal; font-weight: 500; font-size: 0.9em; display:flex; gap: 10px">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M12 0C5.4948 0 0 5.4948 0 12C0 18.5052 5.4948 24 12 24C18.5052 24 24 18.5052 24 12C24 5.4948 18.5052 0 12 0ZM12 6C14.0724 6 15.6 7.5264 15.6 9.6C15.6 11.6736 14.0724 13.2 12 13.2C9.9288 13.2 8.4 11.6736 8.4 9.6C8.4 7.5264 9.9288 6 12 6ZM5.8728 17.7264C6.9492 16.1424 8.7444 15.0864 10.8 15.0864H13.2C15.2568 15.0864 17.0508 16.1424 18.1272 17.7264C16.5936 19.368 14.418 20.4 12 20.4C9.582 20.4 7.4064 19.368 5.8728 17.7264Z" fill="#005F73"/>
                    </svg>
                    <a href="{% url 'authentication:login' %}">Sign in</a>
                </div>
                {% endif %}
            </div>

            <div class="md:hidden flex items-center">
                {% if user.is_authenticated %}
                <button id="logoutButton" style="color: #FFF; font-weight: 500; border-radius: 99px; text-align: center;" class="bg-[#EE9B00] font-medium px-3 py-1 hover:bg-red-400 text-sm" onclick="logout()">Logout</button>
                {% else %}
                <a href="{% url 'authentication:login' %}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M12 0C5.4948 0 0 5.4948 0 12C0 18.5052 5.4948 24 12 24C18.5052 24 24 18.5052 24 12C24 5.4948 18.5052 0 12 0ZM12 6C14.0724 6 15.6 7.5264 15.6 9.6C15.6 11.6736 14.0724 13.2 12 13.2C9.9288 13.2 8.4 11.6736 8.4 9.6C8.4 7.5264 9.9288 6 12 6ZM5.8728 17.7264C6.9492 16.1424 8.7444 15.0864 10.8 15.0864H13.2C15.2568 15.0864 17.0508 16.1424 18.1272 17.7264C16.5936 19.368 14.418 20.4 12 20.4C9.582 20.4 7.4064 19.368 5.8728 17.7264Z" fill="#005F73"/>
                    </svg>
                </a>
                {% endif %}
                <button class="mobile-menu-button p-2 rounded-md focus:outline-none">
                <span class="sr-only">Open menu</span>
                <div class="w-6 h-6 flex flex-col justify-center items-center">
                    <span class="bg-current block transition-all duration-300 ease-out h-0.5 w-6 rounded-sm"></span>
                    <span class="bg-current block transition-all duration-300 ease-out h-0.5 w-6 rounded-sm my-0.5"></span>
                    <span class="bg-current block transition-all duration-300 ease-out h-0.5 w-6 rounded-sm"></span>
                </div>
                </button>
            </div>
        </div>
    </div>

    <div style="stroke-width: 1px; stroke: #808080;">
        <svg xmlns="http://www.w3.org/2000/svg" width="1824" height="7" viewBox="0 0 1824 7" fill="none">
            <path d="M-51 1L1823.99 6.29374" stroke="#808080"/>
        </svg>
    </div>

    <div class="hidden md:flex md:flex-row absolute md:static top-full left-0 w-full bg-white md:bg-transparent shadow-md md:shadow-none z-50" style="justify-content: space-between; align-items: center; flex-shrink: 0; font-size: 0.9em; padding: 20px 40px;">
        <a href="{% url 'catalog:product_list' %}">Products</a>

        <a href="/">Checkout</a>
        <a href="/">Review</a>
        <a href="{% url 'wishlist:list' %}">Wishlist</a>
        <a href="/">Invoice</a>
        <a href="/">Report</a>
    </div>

    <div class="mobile-menu hidden md:hidden border-t">
        <div class="px-2 pt-2 pb-3 space-y-1">
            <div class="flex flex-col space-y-2">
                <a href="{% url 'catalog:product_list' %}">Products</a>

                <a href="/">Checkout</a>
                <a href="/">Review</a>
                <a href="{% url 'wishlist:list' %}">Wishlist</a>
                <a href="/">Invoice</a>
                <a href="/">Report</a>
            </div>
        </div>
    </div>

    <p id="logoutMessage" class="text-center text-sm mt-4 text-gray-600"> </p>
    <form id="csrf-form" class="hidden">{% csrf_token %}</form>
</nav>

<script>
  const btn = document.querySelector("button.mobile-menu-button");
  const menu = document.querySelector(".mobile-menu");
  const message = document.getElementById("logoutMessage");

  if (btn) {
    btn.addEventListener("click", () => {
      menu.classList.toggle("hidden");
    });
  }

  // Ambil CSRF token yang valid dari form tersembunyi
  const csrfInput = document.querySelector('#csrf-form input[name="csrfmiddlewaretoken"]');
  const CSRF_TOKEN = csrfInput ? csrfInput.value : "";

  async function logout() {
    try {
      const response = await fetch("{% url 'authentication:logout' %}", {
        method: "POST",
        headers: {
          "X-CSRFToken": CSRF_TOKEN,
        },
      });

      const data = await response.json();

      if (data.success) {
        message.textContent = "You have been logged out.";
        setTimeout(() => {
          window.location.href = "{% url 'main:show_main' %}";
        }, 800);
      } else {
        message.textContent = data.message || "Logout failed.";
      }
    } catch (e) {
      message.textContent = "Network error. Please try again.";
    }
  }
</script>
